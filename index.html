<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Pro | Sistema de Gesti√≥n</title>
    
    <!-- Fuentes e Iconos -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Configuraci√≥n Avanzada de Tema -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b', 
                            900: '#0f172a',
                        },
                        brand: {
                            dark: '#1e293b',      
                            primary: '#334155',   
                            accent: '#3b82f6',    
                            accentHover: '#2563eb',
                            surface: '#ffffff',
                            bg: '#f1f5f9',        
                            border: '#e2e8f0'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)',
                        'glow': '0 0 15px rgba(59, 130, 246, 0.15)',
                        'card': '0 0 0 1px rgba(0,0,0,0.03), 0 2px 8px rgba(0,0,0,0.04)',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.4s ease-out forwards',
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both', // Animaci√≥n Shake corregida
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; -webkit-font-smoothing: antialiased; }
        
        /* Glassmorphism Utilities */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .glass-dark {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Table Styles */
        tr.hover-row:hover td { background-color: #f8fafc; }
    </style>
</head>
<body class="text-slate-600 h-screen overflow-hidden flex flex-col selection:bg-brand-accent selection:text-white">

    <!-- ========================================== -->
    <!-- TOAST NOTIFICATIONS (Improved) -->
    <!-- ========================================== -->
    <div id="toast-container" class="fixed top-6 right-6 z-[60] flex flex-col gap-3 pointer-events-none"></div>

    <!-- ========================================== -->
    <!-- AUTH VIEW (LOGIN/REGISTER) -->
    <!-- ========================================== -->
    <div id="auth-view" class="flex-1 flex items-center justify-center bg-[#f8fafc] p-4 relative overflow-hidden">
        <!-- Fondos Ambientales -->
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden z-0">
            <div class="absolute top-[-10%] right-[-5%] w-[500px] h-[500px] bg-blue-100 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-pulse"></div>
            <div class="absolute bottom-[-10%] left-[-5%] w-[500px] h-[500px] bg-indigo-100 rounded-full mix-blend-multiply filter blur-3xl opacity-70"></div>
        </div>

        <div class="glass bg-white/80 shadow-2xl rounded-2xl overflow-hidden w-full max-w-5xl flex flex-col md:flex-row shadow-slate-200/50 z-10 h-[650px] animate-fade-in border border-white/50">
            <!-- Panel Arte -->
            <div class="md:w-1/2 bg-slate-900 text-white p-12 flex flex-col justify-between relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-br from-slate-800 to-slate-900 z-0"></div>
                <div class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] z-0"></div>
                
                <!-- Decoraci√≥n Abstracta -->
                <div class="absolute -right-12 top-20 w-40 h-40 bg-brand-accent rounded-full blur-[60px] opacity-20 z-0"></div>

                <div class="z-10 relative">
                    <div class="flex items-center gap-2 mb-8">
                        <div class="w-8 h-8 rounded bg-brand-accent flex items-center justify-center shadow-glow">
                            <i class="fa-solid fa-cube text-white text-sm"></i>
                        </div>
                        <span class="font-bold tracking-tight text-lg">Nexus<span class="font-light text-slate-400">Pro</span></span>
                    </div>
                    <h1 class="text-4xl font-bold mb-4 leading-tight">Gesti√≥n inteligente para equipos modernos.</h1>
                    <p class="text-slate-400 text-sm leading-relaxed max-w-xs">Optimiza flujos de trabajo, gestiona usuarios y analiza m√©tricas en tiempo real con nuestra plataforma empresarial.</p>
                </div>

                <div class="z-10 relative mt-auto">
                    <div class="flex -space-x-3 mb-4">
                        <img class="w-10 h-10 rounded-full border-2 border-slate-800" src="https://i.pravatar.cc/100?img=33" alt="">
                        <img class="w-10 h-10 rounded-full border-2 border-slate-800" src="https://i.pravatar.cc/100?img=47" alt="">
                        <img class="w-10 h-10 rounded-full border-2 border-slate-800" src="https://i.pravatar.cc/100?img=12" alt="">
                        <div class="w-10 h-10 rounded-full border-2 border-slate-800 bg-slate-700 flex items-center justify-center text-xs font-bold">+2k</div>
                    </div>
                    <p class="text-xs text-slate-500 font-medium">Confiado por m√°s de 2,000 empresas</p>
                </div>
            </div>

            <!-- Panel Formulario -->
            <div class="md:w-1/2 p-12 flex flex-col justify-center bg-white relative">
                <form id="login-form" class="flex flex-col gap-5 w-full max-w-sm mx-auto animate-slide-up">
                    <div class="mb-2">
                        <h2 class="text-2xl font-bold text-slate-800">Bienvenido</h2>
                        <p class="text-slate-400 text-sm">Accede a tu panel de control</p>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-xs font-semibold text-slate-500 uppercase mb-1.5 ml-1 tracking-wide">Email</label>
                            <input type="email" id="login-email" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:border-brand-accent focus:ring-4 focus:ring-brand-accent/10 transition-all bg-slate-50 focus:bg-white text-sm font-medium placeholder-slate-400" placeholder="usuario@empresa.com" required>
                        </div>

                        <div>
                            <label class="block text-xs font-semibold text-slate-500 uppercase mb-1.5 ml-1 tracking-wide">Contrase√±a</label>
                            <input type="password" id="login-pass" class="w-full px-4 py-3 border border-slate-200 rounded-xl focus:outline-none focus:border-brand-accent focus:ring-4 focus:ring-brand-accent/10 transition-all bg-slate-50 focus:bg-white text-sm font-medium placeholder-slate-400" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                        </div>
                    </div>

                    <div class="flex items-center justify-between text-xs text-slate-500 mt-1">
                        <label class="flex items-center gap-2 cursor-pointer hover:text-brand-accent transition-colors">
                            <input type="checkbox" class="rounded border-slate-300 text-brand-accent focus:ring-brand-accent">
                            Recordar sesi√≥n
                        </label>
                        <a href="#" class="font-medium hover:text-brand-accent transition-colors">Recuperar contrase√±a</a>
                    </div>

                    <button type="submit" class="group bg-brand-accent hover:bg-brand-accentHover text-white font-semibold py-3.5 rounded-xl transition-all shadow-lg shadow-blue-500/30 hover:shadow-blue-500/40 hover:-translate-y-0.5 active:translate-y-0 mt-4 flex justify-center items-center gap-2">
                        <span>Iniciar Sesi√≥n</span>
                        <i class="fa-solid fa-arrow-right text-xs group-hover:translate-x-1 transition-transform"></i>
                    </button>

                    <div class="text-center mt-6">
                        <p class="text-xs text-slate-400">
                            ¬øA√∫n no tienes cuenta? <a href="#" onclick="toggleAuth('register')" class="text-brand-accent hover:text-brand-accentHover font-bold cursor-pointer ml-1 transition-colors">Solicitar Demo</a>
                        </p>
                    </div>
                </form>

                <!-- Formulario Registro -->
                <form id="register-form" class="flex flex-col gap-5 w-full max-w-sm mx-auto hidden animate-slide-up">
                    <div class="mb-2">
                        <h2 class="text-2xl font-bold text-slate-800">Crear Cuenta</h2>
                        <p class="text-slate-400 text-sm">Configura tu espacio de trabajo en segundos</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-xs font-semibold text-slate-500 uppercase mb-1 block">Nombre</label>
                            <input type="text" id="reg-name" class="w-full px-3 py-2.5 border border-slate-200 rounded-lg text-sm focus:border-brand-accent focus:ring-2 focus:ring-brand-accent/10 outline-none bg-slate-50" required>
                        </div>
                        <div>
                            <label class="text-xs font-semibold text-slate-500 uppercase mb-1 block">Apellido</label>
                            <input type="text" id="reg-lastname" class="w-full px-3 py-2.5 border border-slate-200 rounded-lg text-sm focus:border-brand-accent focus:ring-2 focus:ring-brand-accent/10 outline-none bg-slate-50" required>
                        </div>
                    </div>

                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 block">Email</label>
                        <input type="email" id="reg-email" class="w-full px-3 py-2.5 border border-slate-200 rounded-lg text-sm focus:border-brand-accent focus:ring-2 focus:ring-brand-accent/10 outline-none bg-slate-50" required>
                    </div>

                    <div>
                        <label class="text-xs font-semibold text-slate-500 uppercase mb-1 block">Contrase√±a</label>
                        <input type="password" id="reg-pass" class="w-full px-3 py-2.5 border border-slate-200 rounded-lg text-sm focus:border-brand-accent focus:ring-2 focus:ring-brand-accent/10 outline-none bg-slate-50" required>
                    </div>

                    <button type="submit" class="bg-slate-800 hover:bg-slate-900 text-white font-semibold py-3 rounded-lg transition-all shadow-md mt-2">
                        Comenzar Ahora
                    </button>

                    <div class="text-center mt-4">
                        <p class="text-xs text-slate-400">
                            ¬øYa tienes cuenta? <a href="#" onclick="toggleAuth('login')" class="text-brand-accent font-bold cursor-pointer ml-1">Volver</a>
                        </p>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- DASHBOARD VIEW -->
    <!-- ========================================== -->
    <div id="dashboard-view" class="hidden h-screen flex overflow-hidden bg-brand-bg">
        
        <!-- Sidebar Premium -->
        <aside class="w-72 bg-slate-900 text-slate-300 flex-col hidden md:flex shadow-2xl z-30 transition-all duration-300 relative border-r border-slate-800/50" id="sidebar">
            <!-- Logo Area -->
            <div class="h-20 flex items-center px-6 border-b border-slate-800/50 bg-slate-900/50 backdrop-blur-sm">
                <div class="flex items-center gap-3">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-500/20 text-white">
                        <i class="fa-solid fa-cube text-xs"></i>
                    </div>
                    <span class="font-bold text-lg text-white tracking-tight">Nexus<span class="text-slate-500 font-light">Pro</span></span>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto custom-scrollbar">
                <div class="text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-3 px-2">Dashboard</div>
                
                <button onclick="switchView('users')" id="nav-users" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-all group relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-600/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <i class="fa-solid fa-users w-5 text-center transition-colors"></i>
                    <span>Usuarios</span>
                    <span class="ml-auto text-[10px] bg-slate-800 text-slate-400 px-1.5 py-0.5 rounded border border-slate-700" id="badge-total-users">0</span>
                </button>
                
                <button onclick="switchView('analytics')" id="nav-analytics" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-slate-400 hover:text-white hover:bg-white/5 transition-all group">
                    <i class="fa-solid fa-chart-pie w-5 text-center"></i>
                    <span>Anal√≠ticas</span>
                </button>

                <div class="text-[11px] font-bold text-slate-500 uppercase tracking-wider mb-3 mt-8 px-2">Sistema</div>

                <button onclick="switchView('settings')" id="nav-settings" class="w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-slate-400 hover:text-white hover:bg-white/5 transition-all group">
                    <i class="fa-solid fa-gear w-5 text-center"></i>
                    <span>Configuraci√≥n</span>
                </button>
            </nav>

            <!-- User Profile Bottom -->
            <div class="p-4 border-t border-slate-800 bg-slate-900/50">
                <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-white/5 transition-colors cursor-pointer group" onclick="switchView('settings')">
                    <div class="w-9 h-9 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500 flex items-center justify-center text-white text-xs font-bold shadow-md ring-2 ring-slate-800 group-hover:ring-slate-700 transition-all" id="user-avatar">
                        U
                    </div>
                    <div class="flex-1 overflow-hidden">
                        <p class="text-sm font-semibold text-white truncate" id="current-user-name">Usuario</p>
                        <p class="text-xs text-slate-500 truncate">Administrador</p>
                    </div>
                    <button onclick="logout(event)" class="text-slate-500 hover:text-red-400 transition-colors p-1.5 rounded-md hover:bg-red-500/10" title="Cerrar sesi√≥n">
                        <i class="fa-solid fa-arrow-right-from-bracket text-xs"></i>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col relative h-full overflow-hidden min-w-0">
            
            <!-- Top Header Glass -->
            <header class="h-20 flex items-center justify-between px-8 z-20 bg-brand-bg/80 backdrop-blur-md sticky top-0">
                <div class="flex items-center gap-4">
                    <button class="md:hidden text-slate-500 hover:text-slate-800 transition-colors p-2 -ml-2 rounded-lg active:bg-slate-200" onclick="toggleMobileMenu()">
                        <i class="fa-solid fa-bars text-lg"></i>
                    </button>
                    <div>
                        <h2 class="text-xl font-bold text-slate-800 tracking-tight" id="page-title">Gesti√≥n de Usuarios</h2>
                        <p class="text-xs text-slate-400 hidden sm:block">Vista general del sistema</p>
                    </div>
                </div>
                
                <div class="flex items-center gap-5">
                    <!-- Search Bar -->
                    <div class="relative hidden sm:block group">
                        <i class="fa-solid fa-search absolute left-3.5 top-3 text-slate-400 group-focus-within:text-brand-accent transition-colors text-sm"></i>
                        <input type="text" id="search-input" placeholder="Buscar..." class="pl-10 pr-4 py-2.5 bg-white border border-slate-200 rounded-full text-sm focus:outline-none focus:border-brand-accent focus:ring-4 focus:ring-brand-accent/10 w-64 focus:w-80 transition-all shadow-sm">
                    </div>

                    <!-- Actions -->
                    <button class="relative p-2 text-slate-400 hover:text-slate-600 transition-colors rounded-full hover:bg-white hover:shadow-sm">
                        <i class="fa-regular fa-bell"></i>
                        <span class="absolute top-1.5 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-brand-bg"></span>
                    </button>
                    
                    <div class="h-8 w-px bg-slate-200 mx-1"></div>
                    
                    <span id="current-time" class="text-xs font-mono text-slate-500 bg-white px-3 py-1.5 rounded-md border border-slate-200 shadow-sm">12:00</span>
                </div>
            </header>

            <!-- Scrollable Content -->
            <div class="flex-1 overflow-y-auto px-8 pb-8 scroll-smooth" id="main-scroll">
                
                <!-- VIEW: USERS LIST -->
                <div id="view-users" class="space-y-8 pt-4 animate-fade-in">
                    
                    <!-- KPI Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-2xl shadow-card border border-slate-100 flex flex-col justify-between h-32 group hover:shadow-soft transition-all relative overflow-hidden">
                            <div class="absolute right-0 top-0 w-24 h-24 bg-blue-50 rounded-bl-[100px] -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                            <div class="relative z-10">
                                <div class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">Total Usuarios</div>
                                <div class="text-3xl font-bold text-slate-800" id="stat-total">0</div>
                            </div>
                            <div class="relative z-10 flex items-center text-xs text-green-500 font-medium mt-auto">
                                <i class="fa-solid fa-arrow-trend-up mr-1"></i> +12% vs mes anterior
                            </div>
                            <div class="absolute top-5 right-5 text-brand-accent/30 text-xl group-hover:text-brand-accent transition-colors">
                                <i class="fa-solid fa-users"></i>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-2xl shadow-card border border-slate-100 flex flex-col justify-between h-32 group hover:shadow-soft transition-all relative overflow-hidden">
                             <div class="absolute right-0 top-0 w-24 h-24 bg-emerald-50 rounded-bl-[100px] -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                            <div class="relative z-10">
                                <div class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">Activos Ahora</div>
                                <div class="text-3xl font-bold text-slate-800" id="stat-active">0</div>
                            </div>
                            <div class="absolute top-5 right-5 text-emerald-500/30 text-xl group-hover:text-emerald-500 transition-colors">
                                <i class="fa-regular fa-circle-check"></i>
                            </div>
                        </div>

                         <div class="bg-white p-6 rounded-2xl shadow-card border border-slate-100 flex flex-col justify-between h-32 group hover:shadow-soft transition-all relative overflow-hidden">
                             <div class="absolute right-0 top-0 w-24 h-24 bg-purple-50 rounded-bl-[100px] -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                            <div class="relative z-10">
                                <div class="text-slate-400 text-xs font-bold uppercase tracking-wider mb-1">Administradores</div>
                                <div class="text-3xl font-bold text-slate-800" id="stat-admin">0</div>
                            </div>
                            <div class="absolute top-5 right-5 text-purple-500/30 text-xl group-hover:text-purple-500 transition-colors">
                                <i class="fa-solid fa-shield-cat"></i>
                            </div>
                        </div>

                        <button onclick="exportToCSV()" class="bg-white p-6 rounded-2xl shadow-card border border-dashed border-slate-300 flex flex-col items-center justify-center h-32 hover:bg-slate-50 hover:border-brand-accent/50 transition-all group gap-2 cursor-pointer">
                            <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 group-hover:bg-brand-accent group-hover:text-white transition-colors">
                                <i class="fa-solid fa-cloud-arrow-down"></i>
                            </div>
                            <span class="text-sm font-semibold text-slate-600 group-hover:text-brand-accent">Exportar Reporte</span>
                        </button>
                    </div>

                    <!-- Toolbar & Table Wrapper -->
                    <div class="flex flex-col gap-4">
                        <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                            <div class="flex items-center gap-3 bg-white p-1 rounded-lg border border-slate-200 shadow-sm">
                                <button class="px-3 py-1.5 text-xs font-medium bg-slate-100 text-slate-700 rounded-md shadow-sm">Todos</button>
                                <button class="px-3 py-1.5 text-xs font-medium text-slate-500 hover:text-slate-700 hover:bg-slate-50 rounded-md transition-colors">Activos</button>
                                <button class="px-3 py-1.5 text-xs font-medium text-slate-500 hover:text-slate-700 hover:bg-slate-50 rounded-md transition-colors">Inactivos</button>
                            </div>

                            <div class="flex gap-3 w-full sm:w-auto">
                                <select id="sort-select" class="bg-white border border-slate-200 text-slate-600 text-sm rounded-lg focus:ring-brand-accent focus:border-brand-accent p-2.5 outline-none shadow-sm cursor-pointer hover:bg-slate-50 transition-colors">
                                    <option value="newest">Recientes primero</option>
                                    <option value="oldest">Antiguos primero</option>
                                    <option value="az">Alfab√©tico A-Z</option>
                                    <option value="role">Por Rol</option>
                                </select>
                                <button onclick="openModal()" class="bg-slate-900 text-white px-5 py-2.5 rounded-lg text-sm font-semibold hover:bg-slate-800 transition-all shadow-lg shadow-slate-900/20 flex items-center gap-2 transform active:scale-95">
                                    <i class="fa-solid fa-plus text-xs"></i> <span>Nuevo Usuario</span>
                                </button>
                            </div>
                        </div>

                        <div class="bg-white rounded-2xl shadow-card border border-slate-200 overflow-hidden flex flex-col min-h-[400px]">
                            <div class="overflow-x-auto">
                                <table class="w-full text-left border-collapse">
                                    <thead class="bg-slate-50/50 border-b border-slate-200">
                                        <tr>
                                            <th class="p-5 text-[11px] font-bold text-slate-400 uppercase tracking-wider w-1/3">Usuario / Email</th>
                                            <th class="p-5 text-[11px] font-bold text-slate-400 uppercase tracking-wider">Rol & Permisos</th>
                                            <th class="p-5 text-[11px] font-bold text-slate-400 uppercase tracking-wider">Estado</th>
                                            <th class="p-5 text-[11px] font-bold text-slate-400 uppercase tracking-wider hidden md:table-cell">Fecha de Alta</th>
                                            <th class="p-5 text-[11px] font-bold text-slate-400 uppercase tracking-wider text-right">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="users-table-body" class="text-sm divide-y divide-slate-100">
                                        <!-- Dynamic Content Here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Enhanced Empty State -->
                            <div id="empty-state" class="hidden flex-1 flex-col items-center justify-center p-12 text-center">
                                <div class="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mb-4 border border-slate-100 shadow-inner">
                                    <i class="fa-solid fa-magnifying-glass text-slate-300 text-3xl"></i>
                                </div>
                                <h3 class="text-slate-800 font-bold text-lg mb-1">Sin resultados</h3>
                                <p class="text-slate-400 text-sm max-w-xs mx-auto">No hemos encontrado usuarios que coincidan con tu b√∫squeda. Intenta otros t√©rminos.</p>
                                <button onclick="resetFilters()" class="mt-4 text-brand-accent text-sm font-medium hover:underline">Limpiar filtros</button>
                            </div>

                            <!-- Footer Pagination -->
                            <div class="p-4 border-t border-slate-100 bg-slate-50/30 flex flex-col sm:flex-row justify-between items-center gap-4 mt-auto">
                                <span id="showing-text" class="text-xs text-slate-400 font-medium">Cargando datos...</span>
                                <div class="flex items-center gap-1">
                                    <button id="btn-prev" onclick="changePage(-1)" class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 bg-white text-slate-500 hover:bg-brand-accent hover:text-white hover:border-brand-accent transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-sm">
                                        <i class="fa-solid fa-chevron-left text-xs"></i>
                                    </button>
                                    <div id="pagination-numbers" class="flex gap-1 mx-2"></div>
                                    <button id="btn-next" onclick="changePage(1)" class="w-8 h-8 flex items-center justify-center rounded-lg border border-slate-200 bg-white text-slate-500 hover:bg-brand-accent hover:text-white hover:border-brand-accent transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-sm">
                                        <i class="fa-solid fa-chevron-right text-xs"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VIEW: SETTINGS -->
                <div id="view-settings" class="hidden animate-fade-in max-w-3xl mx-auto pt-8">
                    <div class="bg-white rounded-2xl shadow-card border border-slate-200 overflow-hidden">
                        <div class="p-8 border-b border-slate-100 bg-gradient-to-r from-white to-slate-50">
                            <h3 class="font-bold text-xl text-slate-800 mb-1">Perfil de Usuario</h3>
                            <p class="text-sm text-slate-500">Administra tu informaci√≥n personal y preferencias de seguridad.</p>
                        </div>
                        
                        <form id="profile-form" class="p-8 space-y-8">
                            <!-- Avatar Section -->
                            <div class="flex items-center gap-6">
                                <div class="w-24 h-24 rounded-full bg-slate-100 border-4 border-white shadow-lg flex items-center justify-center text-3xl font-bold text-slate-400 overflow-hidden relative group cursor-pointer" id="settings-avatar-bg">
                                    <span id="settings-avatar">U</span>
                                    <div class="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
                                        <i class="fa-solid fa-camera text-white"></i>
                                    </div>
                                </div>
                                <div>
                                    <button type="button" class="text-sm font-semibold text-white bg-slate-800 px-4 py-2 rounded-lg hover:bg-slate-900 transition-colors shadow-md">Subir nueva foto</button>
                                    <button type="button" class="text-sm font-medium text-red-500 px-4 py-2 rounded-lg hover:bg-red-50 transition-colors ml-2">Eliminar</button>
                                    <p class="text-xs text-slate-400 mt-2">Recomendado: 400x400px JPG o PNG.</p>
                                </div>
                            </div>

                            <!-- Inputs Grid -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Nombre</label>
                                    <input type="text" id="profile-name" class="w-full px-4 py-3 border border-slate-200 rounded-xl text-sm focus:border-brand-accent focus:ring-4 focus:ring-brand-accent/10 outline-none transition-all">
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Apellido</label>
                                    <input type="text" id="profile-lastname" class="w-full px-4 py-3 border border-slate-200 rounded-xl text-sm focus:border-brand-accent focus:ring-4 focus:ring-brand-accent/10 outline-none transition-all">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Correo Electr√≥nico</label>
                                <div class="relative">
                                    <i class="fa-solid fa-lock absolute left-4 top-3.5 text-slate-400 text-xs"></i>
                                    <input type="email" id="profile-email" class="w-full pl-10 pr-4 py-3 border border-slate-200 rounded-xl text-sm bg-slate-50 text-slate-500 cursor-not-allowed font-mono" readonly>
                                </div>
                            </div>

                            <div class="pt-6 border-t border-slate-100">
                                <h4 class="font-bold text-slate-800 text-sm mb-6 flex items-center gap-2">
                                    <i class="fa-solid fa-shield-halved text-brand-accent"></i> Seguridad & Sistema
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Nueva Contrase√±a</label>
                                        <input type="password" id="profile-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full px-4 py-3 border border-slate-200 rounded-xl text-sm focus:border-brand-accent focus:ring-4 focus:ring-brand-accent/10 outline-none transition-all">
                                    </div>
                                    <div>
                                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Confirmar Contrase√±a</label>
                                        <input type="password" id="profile-pass-confirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full px-4 py-3 border border-slate-200 rounded-xl text-sm focus:border-brand-accent focus:ring-4 focus:ring-brand-accent/10 outline-none transition-all">
                                    </div>
                                </div>
                                
                                <div class="bg-red-50 border border-red-100 rounded-xl p-4 flex items-center justify-between">
                                    <div>
                                        <h5 class="text-sm font-bold text-red-600">Zona de Peligro</h5>
                                        <p class="text-xs text-red-400">Si el sistema no responde, reinicia la base de datos.</p>
                                    </div>
                                    <button type="button" onclick="resetDB()" class="px-4 py-2 bg-red-100 hover:bg-red-200 text-red-600 text-xs font-bold rounded-lg transition-colors">
                                        Resetear Todo
                                    </button>
                                </div>
                            </div>

                            <div class="flex justify-end pt-4">
                                <button type="submit" class="bg-brand-accent text-white px-8 py-3 rounded-xl hover:bg-brand-accentHover transition-all shadow-lg hover:shadow-xl hover:-translate-y-0.5 text-sm font-semibold flex items-center gap-2">
                                    <i class="fa-regular fa-save"></i> Guardar Cambios
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- VIEW: ANALYTICS (Better Placeholder) -->
                <div id="view-analytics" class="hidden animate-fade-in flex flex-col items-center justify-center h-[500px] text-center p-8">
                    <div class="relative mb-8">
                        <div class="absolute inset-0 bg-blue-400 blur-[40px] opacity-20 rounded-full"></div>
                        <img src="https://cdn-icons-png.flaticon.com/512/8634/8634177.png" class="w-32 h-32 relative z-10 opacity-80 animate-bounce" style="animation-duration: 3s;" alt="Analytics">
                    </div>
                    <h3 class="text-2xl font-bold text-slate-800 mb-2">M√≥dulo en construcci√≥n</h3>
                    <p class="text-slate-500 max-w-md mx-auto leading-relaxed">Estamos preparando tableros avanzados con gr√°ficas en tiempo real. Esta funcionalidad estar√° disponible en la versi√≥n 2.1.</p>
                    <button class="mt-8 px-6 py-2.5 border border-slate-300 rounded-lg text-slate-600 text-sm font-medium hover:bg-white hover:shadow-sm transition-all">Notificarme cuando est√© listo</button>
                </div>

                <div class="mt-12 text-center flex flex-col items-center gap-2 pb-6 opacity-60 hover:opacity-100 transition-opacity">
                    <div class="flex gap-4 text-xs font-semibold text-slate-500">
                        <a href="#" class="hover:text-brand-accent">Documentaci√≥n</a>
                        <a href="#" class="hover:text-brand-accent">Soporte</a>
                        <a href="#" class="hover:text-brand-accent">API</a>
                    </div>
                    <p class="text-[10px] text-slate-400">&copy; 2025 Nexus Enterprise System. Todos los derechos reservados.</p>
                </div>

            </div>
        </main>
    </div>

    <!-- ========================================== -->
    <!-- MODAL (GLASS EFFECT) -->
    <!-- ========================================== -->
    <div id="user-modal" class="fixed inset-0 bg-slate-900/40 hidden items-center justify-center z-50 backdrop-blur-sm transition-all opacity-0" style="transition: opacity 0.3s ease;">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg mx-4 transform scale-95 transition-transform duration-300" id="modal-content">
            <div class="flex justify-between items-center p-6 border-b border-slate-100">
                <div>
                    <h3 class="text-xl font-bold text-slate-800" id="modal-title">Nuevo Registro</h3>
                    <p class="text-xs text-slate-400 mt-0.5">Complete la informaci√≥n del usuario</p>
                </div>
                <button onclick="closeModal()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100 text-slate-400 hover:text-slate-600 transition-colors">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            
            <form id="user-form" class="p-6 space-y-5">
                <input type="hidden" id="user-id">
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="group">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 group-focus-within:text-brand-accent transition-colors">Nombre</label>
                        <input type="text" id="form-name" class="w-full border border-slate-200 rounded-lg px-3 py-2.5 text-sm focus:border-brand-accent focus:ring-4 focus:ring-brand-accent/10 outline-none transition-all" required>
                    </div>
                    <div class="group">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 group-focus-within:text-brand-accent transition-colors">Apellido</label>
                        <input type="text" id="form-lastname" class="w-full border border-slate-200 rounded-lg px-3 py-2.5 text-sm focus:border-brand-accent focus:ring-4 focus:ring-brand-accent/10 outline-none transition-all" required>
                    </div>
                </div>
                
                <div class="group">
                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5 group-focus-within:text-brand-accent transition-colors">Email Corporativo</label>
                    <div class="relative">
                        <i class="fa-regular fa-envelope absolute left-3 top-3 text-slate-400"></i>
                        <input type="email" id="form-email" class="w-full pl-9 border border-slate-200 rounded-lg px-3 py-2.5 text-sm focus:border-brand-accent focus:ring-4 focus:ring-brand-accent/10 outline-none transition-all" placeholder="ejemplo@empresa.com" required>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="group">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5">Rol de Sistema</label>
                        <div class="relative">
                             <select id="form-role" class="w-full border border-slate-200 rounded-lg px-3 py-2.5 text-sm bg-white outline-none focus:border-brand-accent focus:ring-4 focus:ring-brand-accent/10 transition-all appearance-none cursor-pointer">
                                <option value="Usuario">Usuario Est√°ndar</option>
                                <option value="Editor">Editor de Contenido</option>
                                <option value="Admin">Administrador Global</option>
                            </select>
                            <i class="fa-solid fa-chevron-down absolute right-3 top-3.5 text-xs text-slate-400 pointer-events-none"></i>
                        </div>
                    </div>
                    <div class="group">
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1.5">Estado</label>
                        <div class="relative">
                            <select id="form-status" class="w-full border border-slate-200 rounded-lg px-3 py-2.5 text-sm bg-white outline-none focus:border-brand-accent focus:ring-4 focus:ring-brand-accent/10 transition-all appearance-none cursor-pointer">
                                <option value="Activo">üü¢ Activo</option>
                                <option value="Inactivo">üî¥ Inactivo</option>
                            </select>
                            <i class="fa-solid fa-chevron-down absolute right-3 top-3.5 text-xs text-slate-400 pointer-events-none"></i>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 pt-6 border-t border-slate-50 mt-2">
                    <button type="button" onclick="closeModal()" class="px-5 py-2.5 rounded-lg text-slate-500 hover:bg-slate-50 text-sm font-medium transition-colors">Cancelar</button>
                    <button type="submit" class="px-6 py-2.5 rounded-lg bg-slate-900 text-white hover:bg-slate-800 shadow-lg shadow-slate-900/20 hover:shadow-xl text-sm font-semibold transition-all flex items-center gap-2 transform active:scale-95">
                        <i class="fa-solid fa-check"></i> Guardar Usuario
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ========================================== -->
    <!-- JAVASCRIPT LOGIC (Enhanced) -->
    <!-- ========================================== -->
    <script>
        // --- CONFIG ---
        const CONFIG = {
            keys: { users: 'nexus_users_db', session: 'nexus_session' },
            colors: [
                'bg-blue-500', 'bg-emerald-500', 'bg-violet-500', 
                'bg-rose-500', 'bg-amber-500', 'bg-cyan-500', 'bg-indigo-500'
            ],
            itemsPerPage: 6 // Aumentado para mejor uso del espacio
        };

        let state = {
            users: [],
            currentUser: null,
            currentPage: 1,
            sortBy: 'newest',
            filter: ''
        };

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            loadDB();
            checkSession();
            setupListeners();
            updateTime();
            setInterval(updateTime, 60000);
        });

        function setupListeners() {
            document.getElementById('login-form').addEventListener('submit', handleLogin);
            document.getElementById('register-form').addEventListener('submit', handleRegister);
            document.getElementById('user-form').addEventListener('submit', handleSaveUser);
            document.getElementById('profile-form').addEventListener('submit', handleUpdateProfile);

            document.getElementById('search-input').addEventListener('input', (e) => {
                state.filter = e.target.value;
                state.currentPage = 1;
                renderApp();
            });
            document.getElementById('sort-select').addEventListener('change', (e) => {
                state.sortBy = e.target.value;
                renderApp();
            });
        }

        // --- DATA LAYER ---
        function loadDB() {
            try {
                const stored = localStorage.getItem(CONFIG.keys.users);
                if (stored) {
                    const parsed = JSON.parse(stored);
                    if (Array.isArray(parsed)) {
                        state.users = parsed;
                    } else {
                        throw new Error('Datos corruptos');
                    }
                } else {
                    seedData();
                }
            } catch (e) {
                console.error('Error cargando DB, reseteando...', e);
                seedData();
            }
        }

        function seedData() {
            // Seed Data con colores y fechas m√°s realistas
            const seed = [
                { id: 1, name: 'Alex', lastname: 'Morgan', email: 'alex@nexus.com', password: '123', role: 'Admin', status: 'Activo', color: 'bg-slate-800', createdAt: Date.now(), lastLogin: Date.now() },
                { id: 2, name: 'Sarah', lastname: 'Connor', email: 'sarah@tech.com', password: '123', role: 'Editor', status: 'Activo', color: 'bg-violet-500', createdAt: Date.now() - 86400000 * 2, lastLogin: Date.now() - 3600000 },
                { id: 3, name: 'John', lastname: 'Doe', email: 'john@dummy.com', password: '123', role: 'Usuario', status: 'Inactivo', color: 'bg-blue-500', createdAt: Date.now() - 86400000 * 10, lastLogin: null },
                { id: 4, name: 'Emily', lastname: 'Blunt', email: 'emily@design.io', password: '123', role: 'Editor', status: 'Activo', color: 'bg-rose-500', createdAt: Date.now() - 86400000 * 5, lastLogin: Date.now() - 7200000 },
                { id: 5, name: 'Michael', lastname: 'Scott', email: 'mscott@dunder.com', password: '123', role: 'Admin', status: 'Activo', color: 'bg-emerald-500', createdAt: Date.now() - 86400000 * 20, lastLogin: Date.now() - 100000 },
                { id: 6, name: 'David', lastname: 'Wallace', email: 'david@cfo.com', password: '123', role: 'Usuario', status: 'Inactivo', color: 'bg-amber-500', createdAt: Date.now() - 86400000 * 25, lastLogin: null },
            ];
            state.users = seed;
            saveDB();
        }

        function saveDB() {
            localStorage.setItem(CONFIG.keys.users, JSON.stringify(state.users));
        }

        function resetDB() {
            if(confirm('ATENCI√ìN: Esto borrar√° todos los usuarios y restaurar√° los datos de prueba. ¬øContinuar?')) {
                localStorage.removeItem(CONFIG.keys.users);
                localStorage.removeItem(CONFIG.keys.session);
                window.location.reload();
            }
        }

        // --- AUTH ---
        function handleLogin(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            
            // Simular carga
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> Procesando...';
            btn.disabled = true;

            setTimeout(() => {
                const email = document.getElementById('login-email').value;
                const pass = document.getElementById('login-pass').value;
                const user = state.users.find(u => u.email === email && u.password === pass);

                if (user) {
                    user.lastLogin = Date.now();
                    saveDB();
                    localStorage.setItem(CONFIG.keys.session, JSON.stringify(user));
                    state.currentUser = user;
                    showToast(`Bienvenido, ${user.name}`, 'success');
                    checkSession();
                } else {
                    showToast('Credenciales incorrectas', 'error');
                    shakeElement(e.target);
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            }, 800); // Retardo artificial para sensaci√≥n de proceso
        }

        function handleRegister(e) {
            e.preventDefault();
            const email = document.getElementById('reg-email').value;
            
            if (state.users.some(u => u.email === email)) {
                showToast('Email ya registrado', 'error');
                return;
            }

            const newUser = {
                id: Date.now(),
                name: document.getElementById('reg-name').value,
                lastname: document.getElementById('reg-lastname').value,
                email: email,
                password: document.getElementById('reg-pass').value,
                role: 'Usuario',
                status: 'Activo',
                color: CONFIG.colors[Math.floor(Math.random() * CONFIG.colors.length)],
                createdAt: Date.now(),
                lastLogin: Date.now()
            };

            state.users.push(newUser);
            saveDB();
            localStorage.setItem(CONFIG.keys.session, JSON.stringify(newUser));
            showToast('Cuenta creada exitosamente', 'success');
            setTimeout(() => window.location.reload(), 500);
        }

        function logout(e) {
            if(e) e.stopPropagation();
            // Efecto de salida
            document.body.style.opacity = '0';
            document.body.style.transition = 'opacity 0.5s';
            setTimeout(() => {
                localStorage.removeItem(CONFIG.keys.session);
                window.location.reload();
            }, 500);
        }

        function checkSession() {
            const session = localStorage.getItem(CONFIG.keys.session);
            const authView = document.getElementById('auth-view');
            const dashboardView = document.getElementById('dashboard-view');

            if (session) {
                try {
                    state.currentUser = JSON.parse(session);
                    authView.classList.add('hidden');
                    dashboardView.classList.remove('hidden');
                    dashboardView.classList.add('flex');
                    
                    updateUserProfileUI();
                    renderApp();
                } catch(e) {
                    localStorage.removeItem(CONFIG.keys.session);
                }
            } else {
                dashboardView.classList.add('hidden');
                dashboardView.classList.remove('flex');
                authView.classList.remove('hidden');
            }
        }

        function toggleAuth(type) {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            
            if (type === 'register') {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
                registerForm.classList.add('animate-slide-up');
            } else {
                registerForm.classList.add('hidden');
                loginForm.classList.remove('hidden');
                loginForm.classList.add('animate-slide-up');
            }
        }

        function updateUserProfileUI() {
            const user = state.currentUser;
            document.getElementById('current-user-name').textContent = `${user.name} ${user.lastname}`;
            document.getElementById('user-avatar').textContent = user.name.charAt(0);
            
            // Perfil View
            document.getElementById('profile-name').value = user.name;
            document.getElementById('profile-lastname').value = user.lastname;
            document.getElementById('profile-email').value = user.email;
            document.getElementById('settings-avatar').textContent = user.name.charAt(0);
        }

        // --- RENDER LOGIC ---
        function renderApp() {
            renderTable();
            updateStats();
            document.getElementById('badge-total-users').innerText = state.users.length;
        }

        function renderTable() {
            const tbody = document.getElementById('users-table-body');
            const emptyState = document.getElementById('empty-state');
            
            // Filtros y Orden
            let result = state.users.filter(u => 
                u.name.toLowerCase().includes(state.filter.toLowerCase()) || 
                u.email.toLowerCase().includes(state.filter.toLowerCase())
            );

            // Sort Logic
            if(state.sortBy === 'newest') result.sort((a,b) => b.createdAt - a.createdAt);
            if(state.sortBy === 'oldest') result.sort((a,b) => a.createdAt - b.createdAt);
            if(state.sortBy === 'az') result.sort((a,b) => a.name.localeCompare(b.name));
            if(state.sortBy === 'role') result.sort((a,b) => a.role.localeCompare(b.role));

            // Pagination
            const totalPages = Math.ceil(result.length / CONFIG.itemsPerPage);
            if (state.currentPage > totalPages) state.currentPage = Math.max(1, totalPages);
            
            const start = (state.currentPage - 1) * CONFIG.itemsPerPage;
            const paginated = result.slice(start, start + CONFIG.itemsPerPage);

            tbody.innerHTML = '';

            if (result.length === 0) {
                emptyState.classList.remove('hidden');
                emptyState.classList.add('flex');
                document.getElementById('showing-text').textContent = '0 resultados';
            } else {
                emptyState.classList.add('hidden');
                emptyState.classList.remove('flex');

                paginated.forEach((u, index) => {
                    const date = new Date(u.createdAt).toLocaleDateString('es-ES', { month: 'short', day: 'numeric', year: 'numeric' });
                    
                    // Badges Logic
                    let roleBadge = '';
                    if(u.role === 'Admin') roleBadge = '<span class="px-2 py-0.5 rounded text-[10px] font-bold bg-purple-100 text-purple-700 border border-purple-200 uppercase tracking-wide">Admin</span>';
                    else if(u.role === 'Editor') roleBadge = '<span class="px-2 py-0.5 rounded text-[10px] font-bold bg-blue-50 text-blue-600 border border-blue-100 uppercase tracking-wide">Editor</span>';
                    else roleBadge = '<span class="px-2 py-0.5 rounded text-[10px] font-bold bg-slate-100 text-slate-500 border border-slate-200 uppercase tracking-wide">Usuario</span>';

                    const statusColor = u.status === 'Activo' ? 'text-emerald-500 bg-emerald-50 border-emerald-100' : 'text-slate-400 bg-slate-100 border-slate-200';
                    const statusDot = u.status === 'Activo' ? 'bg-emerald-500' : 'bg-slate-400';

                    const tr = document.createElement('tr');
                    tr.className = 'hover-row transition-colors border-b border-slate-50 last:border-0 group animate-slide-up';
                    tr.style.animationDelay = `${index * 50}ms`; // Stagger effect
                    
                    tr.innerHTML = `
                        <td class="p-5">
                            <div class="flex items-center gap-4">
                                <div class="w-10 h-10 rounded-full ${u.color} text-white flex items-center justify-center font-bold text-sm shadow-md ring-2 ring-white">
                                    ${u.name.charAt(0)}
                                </div>
                                <div>
                                    <div class="font-bold text-slate-700 text-sm group-hover:text-brand-accent transition-colors">${u.name} ${u.lastname}</div>
                                    <div class="text-xs text-slate-400 font-mono mt-0.5">${u.email}</div>
                                </div>
                            </div>
                        </td>
                        <td class="p-5 align-middle">
                            ${roleBadge}
                        </td>
                        <td class="p-5 align-middle">
                            <div class="inline-flex items-center gap-2 px-2.5 py-1 rounded-full border ${statusColor}">
                                <span class="w-1.5 h-1.5 rounded-full ${statusDot}"></span>
                                <span class="text-xs font-semibold">${u.status}</span>
                            </div>
                        </td>
                        <td class="p-5 hidden md:table-cell align-middle">
                            <div class="text-xs text-slate-500 font-medium">${date}</div>
                        </td>
                        <td class="p-5 text-right align-middle">
                            <div class="flex justify-end gap-2 opacity-0 group-hover:opacity-100 transition-all transform translate-x-2 group-hover:translate-x-0">
                                <button onclick="prepareEdit(${u.id})" class="w-8 h-8 rounded-lg bg-white border border-slate-200 text-slate-400 hover:text-brand-accent hover:border-brand-accent hover:shadow-sm transition-all flex items-center justify-center" title="Editar">
                                    <i class="fa-solid fa-pen text-xs"></i>
                                </button>
                                <button onclick="deleteUser(${u.id})" class="w-8 h-8 rounded-lg bg-white border border-slate-200 text-slate-400 hover:text-red-500 hover:border-red-200 hover:bg-red-50 transition-all flex items-center justify-center" title="Eliminar">
                                    <i class="fa-regular fa-trash-can text-xs"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
                
                // Pagination Text
                const rangeStart = start + 1;
                const rangeEnd = Math.min(start + CONFIG.itemsPerPage, result.length);
                document.getElementById('showing-text').textContent = `Mostrando ${rangeStart}-${rangeEnd} de ${result.length} registros`;
            }

            // Pagination Buttons
            document.getElementById('btn-prev').disabled = state.currentPage === 1;
            document.getElementById('btn-next').disabled = state.currentPage >= totalPages || totalPages === 0;
            
            // Simple Page Dots
            const dots = document.getElementById('pagination-numbers');
            dots.innerHTML = '';
            if(totalPages > 0) {
                const dot = document.createElement('span');
                dot.className = 'text-xs font-bold text-slate-800 bg-white border border-slate-200 px-2 py-1 rounded shadow-sm';
                dot.innerText = `${state.currentPage} / ${totalPages}`;
                dots.appendChild(dot);
            }
        }

        // --- CRUD ACTIONS ---
        function openModal() {
            document.getElementById('user-form').reset();
            document.getElementById('user-id').value = '';
            document.getElementById('modal-title').textContent = 'Crear Nuevo Usuario';
            
            const modal = document.getElementById('user-modal');
            const content = document.getElementById('modal-content');
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // Forzar reflow para animaci√≥n
            void modal.offsetWidth; 
            
            modal.classList.remove('opacity-0');
            modal.classList.add('opacity-100');
            
            setTimeout(() => {
                content.classList.remove('scale-95');
                content.classList.add('scale-100');
            }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('user-modal');
            const content = document.getElementById('modal-content');
            
            content.classList.remove('scale-100');
            content.classList.add('scale-95');
            modal.classList.remove('opacity-100');
            modal.classList.add('opacity-0');
            
            setTimeout(() => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }, 300);
        }

        function handleSaveUser(e) {
            e.preventDefault();
            const id = document.getElementById('user-id').value;
            const email = document.getElementById('form-email').value;
            
            // Check Duplicates
            if (state.users.some(u => u.email === email && u.id.toString() !== id)) {
                showToast('Este email ya est√° en uso', 'error');
                return;
            }

            const userData = {
                name: document.getElementById('form-name').value,
                lastname: document.getElementById('form-lastname').value,
                email: email,
                role: document.getElementById('form-role').value,
                status: document.getElementById('form-status').value
            };

            if(id) {
                // Update
                const idx = state.users.findIndex(u => u.id.toString() === id);
                state.users[idx] = { ...state.users[idx], ...userData };
                showToast('Usuario actualizado correctamente');
            } else {
                // Create
                state.users.push({
                    id: Date.now(),
                    ...userData,
                    password: '123',
                    color: CONFIG.colors[Math.floor(Math.random() * CONFIG.colors.length)],
                    createdAt: Date.now(),
                    lastLogin: null
                });
                showToast('Usuario creado exitosamente');
            }
            
            saveDB();
            closeModal();
            renderApp();
        }

        function prepareEdit(id) {
            const user = state.users.find(u => u.id === id);
            if(!user) return;
            
            document.getElementById('user-id').value = user.id;
            document.getElementById('form-name').value = user.name;
            document.getElementById('form-lastname').value = user.lastname;
            document.getElementById('form-email').value = user.email;
            document.getElementById('form-role').value = user.role;
            document.getElementById('form-status').value = user.status;
            
            document.getElementById('modal-title').textContent = 'Editar Usuario';
            
            const modal = document.getElementById('user-modal');
            const content = document.getElementById('modal-content');

            modal.classList.remove('hidden');
            modal.classList.add('flex');
            void modal.offsetWidth; 
            modal.classList.remove('opacity-0');
            modal.classList.add('opacity-100');
            
             setTimeout(() => {
                content.classList.remove('scale-95');
                content.classList.add('scale-100');
            }, 10);
        }

        function deleteUser(id) {
             const user = state.users.find(u => u.id === id);
             if(user.id === state.currentUser.id) return showToast('No puedes eliminarte a ti mismo', 'error');
             
             if(confirm(`¬øConfirma eliminar a ${user.name}?`)) {
                 state.users = state.users.filter(u => u.id !== id);
                 saveDB();
                 renderApp();
                 showToast('Registro eliminado');
             }
        }

        function handleUpdateProfile(e) {
            e.preventDefault();
            const pass = document.getElementById('profile-pass').value;
            const confirm = document.getElementById('profile-pass-confirm').value;

            if(pass && pass !== confirm) return showToast('Las contrase√±as no coinciden', 'error');

            const idx = state.users.findIndex(u => u.id === state.currentUser.id);
            state.users[idx].name = document.getElementById('profile-name').value;
            state.users[idx].lastname = document.getElementById('profile-lastname').value;
            if(pass) state.users[idx].password = pass;

            state.currentUser = state.users[idx];
            saveDB();
            localStorage.setItem(CONFIG.keys.session, JSON.stringify(state.currentUser));
            showToast('Perfil actualizado');
            updateUserProfileUI();
            renderApp(); // Update header name
        }

        // --- UTILS & UI EFFECTS ---
        function switchView(view) {
            ['users', 'analytics', 'settings'].forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
                const btn = document.getElementById(`nav-${v}`);
                // Reset styles
                btn.className = 'w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-slate-400 hover:text-white hover:bg-white/5 transition-all group';
            });

            document.getElementById(`view-${view}`).classList.remove('hidden');
            
            // Active Style
            const activeBtn = document.getElementById(`nav-${view}`);
            activeBtn.className = 'w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium bg-brand-accent text-white shadow-lg shadow-blue-500/20 transition-all group';
        }

        function showToast(msg, type = 'success') {
            const container = document.getElementById('toast-container');
            const el = document.createElement('div');
            
            // Estilo Toast Moderno
            const styles = type === 'success' 
                ? 'bg-slate-900 text-white border border-slate-700' 
                : 'bg-white text-slate-800 border-l-4 border-red-500 shadow-xl';
            
            const icon = type === 'success' ? 'fa-circle-check text-emerald-400' : 'fa-triangle-exclamation text-red-500';

            el.className = `${styles} px-4 py-3 rounded-lg shadow-2xl flex items-center gap-3 min-w-[300px] transform translate-x-10 opacity-0 transition-all duration-300`;
            el.innerHTML = `<i class="fa-solid ${icon}"></i> <span class="text-sm font-medium">${msg}</span>`;

            container.appendChild(el);
            
            requestAnimationFrame(() => {
                el.classList.remove('translate-x-10', 'opacity-0');
            });

            setTimeout(() => {
                el.classList.add('translate-x-10', 'opacity-0');
                setTimeout(() => el.remove(), 300);
            }, 3000);
        }

        function updateStats() {
            // Count up animation would go here
            const total = state.users.length;
            const active = state.users.filter(u => u.status === 'Activo').length;
            const admin = state.users.filter(u => u.role === 'Admin').length;
            
            document.getElementById('stat-total').innerText = total;
            document.getElementById('stat-active').innerText = active;
            document.getElementById('stat-admin').innerText = admin;
        }

        function resetFilters() {
            state.filter = '';
            document.getElementById('search-input').value = '';
            renderApp();
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        function shakeElement(el) {
            el.classList.add('animate-shake');
            setTimeout(() => el.classList.remove('animate-shake'), 500);
        }

        function toggleMobileMenu() {
            const sb = document.getElementById('sidebar');
            sb.classList.toggle('hidden');
            sb.classList.toggle('absolute');
            sb.classList.toggle('h-full');
            sb.classList.toggle('w-64');
        }
        
        function exportToCSV() {
             showToast('Generando reporte...', 'success');
             setTimeout(() => {
                 const csv = "ID,Nombre,Email,Rol,Estado\n" + state.users.map(u => `${u.id},${u.name} ${u.lastname},${u.email},${u.role},${u.status}`).join("\n");
                 const blob = new Blob([csv], { type: 'text/csv' });
                 const url = window.URL.createObjectURL(blob);
                 const a = document.createElement('a');
                 a.setAttribute('hidden', '');
                 a.setAttribute('href', url);
                 a.setAttribute('download', 'reporte_nexus.csv');
                 document.body.appendChild(a);
                 a.click();
                 document.body.removeChild(a);
             }, 1000);
        }
    </script>
</body>
</html>